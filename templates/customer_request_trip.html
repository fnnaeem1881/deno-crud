<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Garibook.com</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <!-- bootstrap   -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- font-family: 'Raleway', sans-serif; -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

</head>

<body>

    <header class="header-wrapper">
        <div class="container">
            <div class="col-md-12">
                <nav class="navbar">
                    <div class="container-fluid">
                        <a class="navbar-brand m-0" href="/">
                            <img src="https://garibook.com/dashboard/new-ui/assets/image/icon/logo.png" alt="Logo"
                                width="200" class="d-inline-block align-text-top">
                        </a>
                        <div class="d-flex">
                            <!-- login Modal -->
                            <div class="modal fade theme-tab-model" id="loginModal" tabindex="-1"
                                aria-labelledby="loginModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header p-0 border-0">
                                            <nav class="auth-tab-header w-100">
                                                <div class="nav nav-tabs w-100 bg-light" role="tablist">
                                                    <button class="nav-link driver active w-50 py-3"
                                                        id="nav-driverLogin-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-driverLogin" type="button" role="tab"
                                                        aria-controls="nav-home" aria-selected="true">Driver Sign
                                                        in</button>
                                                    <button class="nav-link customer w-50 py-3"
                                                        id="nav-customerLogin-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-customerLogin" type="button" role="tab"
                                                        aria-controls="nav-profile" aria-selected="false">Customer Sign
                                                        in</button>
                                                </div>
                                            </nav>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="login-form-wrapper">
                                                <div class="tab-content">
                                                    <div class="tab-pane fade show active" id="nav-driverLogin"
                                                        role="tabpanel" aria-labelledby="nav-driverLogin-tab"
                                                        tabindex="0">
                                                        <form method="POST" action="/driver-login" id="driverLoginForm">
                                                            <div class="mb-3">
                                                                <label for="usermail" class="form-label">Email
                                                                    address</label>
                                                                <input type="email" class="form-control" name="email"
                                                                    id="usermail" aria-describedby="emailHelp">
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="userPassword"
                                                                    class="form-label">Password</label>
                                                                <input type="password" class="form-control"
                                                                    name="password" id="userPassword">
                                                            </div>
                                                            <button type="submit"
                                                                class="btn-theme-primary w-100">Login</button>
                                                        </form>
                                                    </div>
                                                    <div class="tab-pane fade" id="nav-customerLogin" role="tabpanel"
                                                        aria-labelledby="nav-customerLogin-tab" tabindex="0">
                                                        <form method="post" action="/customer-login"
                                                            id="customerLoginForm">
                                                            <div class="mb-3">
                                                                <label for="usermail" class="form-label">Email
                                                                    address</label>
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" aria-describedby="emailHelp">
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="userPassword"
                                                                    class="form-label">Password</label>
                                                                <input type="password" class="form-control"
                                                                    name="password" id="userPassword">
                                                            </div>
                                                            <button type="submit"
                                                                class="btn-theme-secondary w-100">Login</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Register Modal -->
                            <div class="modal fade theme-tab-model" id="registerModal" tabindex="-1"
                                aria-labelledby="registerModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header p-0 border-0">
                                            <nav class="auth-tab-header w-100">
                                                <div class="nav nav-tabs w-100" role="tablist">
                                                    <button class="nav-link driver active w-50 py-3"
                                                        id="nav-driverResister-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-driverResister" type="button" role="tab"
                                                        aria-controls="nav-home" aria-selected="true">Driver
                                                        Register</button>
                                                    <button class="nav-link customer w-50 py-3"
                                                        id="nav-customerResister-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-customerResister" type="button" role="tab"
                                                        aria-controls="nav-profile" aria-selected="false">Customer
                                                        Register</button>
                                                </div>
                                            </nav>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="error_div  mt-3">
                                                <!-- {% if error_customer %}
                                                <div class="alert alert-danger" role="alert">
                                                    {{ error_customer }}
                                                </div>
                                                {% elif success_customer %}
                                                <div class="alert alert-success" role="alert">
                                                    {{ success_customer }}
                                                </div>
                                                {% endif %} -->
                                            </div>
                                            <div class="register-form-wrapper">
                                                <div class="tab-content">
                                                    <div class="tab-pane fade show active" id="nav-driverResister"
                                                        role="tabpanel" aria-labelledby="nav-driverResister-tab"
                                                        tabindex="0">
                                                        <form action="/driver/register/submit" method="post"
                                                            enctype="multipart/form-data">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" name="name"
                                                                    id="name" placeholder="Driver Name ... ">
                                                                <label for="name">Name</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" placeholder="name@example.com">
                                                                <label for="name">Email Address</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="password" id="password"
                                                                    placeholder="*********">
                                                                <label for="password">Password</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="confirm_password" id="confirm_password"
                                                                    placeholder="*********">
                                                                <label for="confirm_password">Confirm Password</label>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <input type="file" class="form-control" name="image"
                                                                    id="image">
                                                            </div>
                                                            <input type="submit" class="btn btn-primary"
                                                                value="Driver Register">
                                                        </form>
                                                    </div>
                                                    <div class="tab-pane fade" id="nav-customerResister" role="tabpanel"
                                                        aria-labelledby="nav-customerResister-tab" tabindex="0">
                                                        <form action="/customer/register/submit" method="post"
                                                            enctype="multipart/form-data">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" name="name"
                                                                    id="name" placeholder="Driver Name ... ">
                                                                <label for="name">Name</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" placeholder="name@example.com">
                                                                <label for="name">Email Address</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="password" id="password"
                                                                    placeholder="*********">
                                                                <label for="password">Password</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="confirm_password" id="confirm_password"
                                                                    placeholder="*********">
                                                                <label for="confirm_password">Confirm Password</label>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <input type="file" class="form-control" name="image"
                                                                    id="image" placeholder="name@example.com">
                                                            </div>
                                                            <input type="submit" class="btn btn-success"
                                                                value="Customer Register">
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="auth-header-wrap d-flex gap-2">
                                <button type="button" class="btn-theme-primary" data-bs-toggle="modal"
                                    data-bs-target="#loginModal">Sign In</button>
                                <button type="button" class="btn-theme-secondary" data-bs-toggle="modal"
                                    data-bs-target="#registerModal">Register</button>
                            </div>

                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <div class="main-wrapper">
        <!-- Breadscrumb Section -->
		<div class="breadcrumb-bar layouts-by-padding-bottom">
			<div class="container">
				<div class="row align-items-center text-center">
		    		<div class="col-md-12 col-12">
			    	    <h2 class="breadcrumb-title">Choose A Trip</h2>
				    	<nav aria-label="breadcrumb" class="page-breadcrumb">
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active" aria-current="page">Trip</li>
							</ol>
						</nav>							
					</div>
				</div>
			</div>
		</div>
		<!-- /Breadscrumb Section -->


        <div class="trip-filter-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <form action="/trip/store" method="post">
                            <div class="trip-f-wrap card bg-body-tertiary p-3 p-sm-5">
                                <div class="row">
                                    <div class="col-md-4 col-sm-6 col-12">
                                        <div class="form-floating ">
                                            <select required class="form-select" name="car_name" id="carType">
                                                <option selected>Choose a Car Type</option>
                                                <option value="Sedan">Sedan</option>
                                                <option value="Noah">Noah</option>
                                                <option value="Hiace">Hiace</option>
                                            </select>
                                            <label for="carType">Car Type</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6 col-12">
                                        <div class="form-floating ">
                                            <input required type="text" class="form-control" name="pick_up_location"
                                                id="pickPoint" placeholder="Pick Up Location">

                                            <label for="pickPoint">Pick Up Location</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6 col-12">
                                        <div class="form-floating">
                                            <input required type="text" class="form-control" name="location"
                                                id="destinationPoint" placeholder="Destination">
                                            <label for="destinationPoint">Destination </label>
                                        </div>

                                    </div>
                                    <div class="col-md-12 col-sm-12 col-12">
                                        <div class="filter-btn-wrap mt-3">
                                            <button type="submit" class="btn-theme-primary text-white w-100">
                                                Choose A ride
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="request-trip-list-wrapper mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table id="example" class="display nowrap table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Car Name</th>
                                        <th scope="col">Pickup location </th>
                                        <th scope="col">Destination</th>
                                        <th scope="col">Booking Time</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="MyTripListShow">
    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        MyTripGet();

        function MyTripGet() {
            $.ajax({
                url: '/customer/trips/get',
                method: 'GET',
                success: function (data) {
                    console.log(data);
                    $('#MyTripListShow').empty(); // Clear old data
                    if (data.length === 0) {
                    } else {
                        for (var i = 0; i < data.length; i++) {
                            var row = $('<tr>');
                            var date = new Date(data[i].created_at);
                            var formattedDate = date.toLocaleString();
                            var index = i + 1; // Incrementing index
                            row.append('<th scope="row">' + index + '</th>');
                            row.append('<td>' + data[i].car_name + '</td>');
                            row.append('<td><p class="text-success m-0">' + data[i].pick_up_location + '</p></td>');
                            row.append('<td><p class="text-success m-0">' + data[i].location + '</p></td>');
                            row.append('<td><p class="text-success m-0">' + formattedDate + '</p></td>');
                            row.append('<td><a href="/show/bid/' + data[i].id + '" class="btn btn-info text-white">Show Bid</a></td>');
                            $('#MyTripListShow').append(row);
                        }
                    }
                    $('#example').DataTable({
                        dom: 'Bfrtip',
                        "order": [[0, "asc"]]
                    });
                }
            });
        }
    </script>



<!-- Footer -->
<footer class="footer section-padding mt-5 ">
    <!-- Footer Top -->
    <div class="footer-top">
        <div class="container">
            <div class="row">
                <div class="col-lg-7">
                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <!-- Footer Widget -->
                            <div class="footer-widget footer-menu">
                                <img src="https://garibook.com/dashboard/new-ui/assets/image/icon/footer_logo.png"
                                    alt="" width="250px">
                                <h5 class="footer-title mt-4">About Garibook</h5>
                                <p class="text-white">Garibook is a car rental platform from NRB Solutions Limited a
                                    concern of Link3 Technologies Limited. Garibook started its journey since 2021.
                                    Garibook is designed to serve passengers from the airport to any destination.
                                    Garibook’s vision is to become a global platform and already offers services in the
                                    United Kingdom, United Arab Emirates, Malaysia, and Thailand.</p>
                            </div>
                            <!-- /Footer Widget -->
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="footer-contact footer-widget">
                        <h5 class="footer-title">Contact Info</h5>
                        <div class="footer-contact-info">
                            <div class="footer-address">
                                <span><i class="fa-solid fa-phone"></i></span>
                                <div class="addr-info">
                                    <a href="#">+ 880 1810 198969</a>
                                </div>
                            </div>
                            <div class="footer-address">
                                <span><i class="fa-solid fa-envelope"></i></span>
                                <div class="addr-info">
                                    <a href="#">help@garibook.com</a>
                                </div>
                            </div>
                        </div>
                        <div class="footer-social-widget">
                            <h6>Connect with us</h6>
                            <ul class="nav-social p-0 d-flex gap-3">
                                <li>
                                    <a href="#" target="_blank"><i
                                            class="fa-brands fa-facebook-f fa-facebook fi-icon"></i></a>
                                </li>
                                <li>
                                    <a href="#" target="_blank"><i class="fab fa-instagram fi-icon"></i></a>
                                </li>
                                <li>
                                    <a href="#" target="_blank"><i class="fab fa-behance fi-icon"></i></a>
                                </li>
                                <li>
                                    <a href="#" target="_blank"><i class="fab fa-twitter fi-icon"></i> </a>
                                </li>
                                <li>
                                    <a href="#" target="_blank"><i class="fab fa-linkedin fi-icon"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Footer Top -->

    <!-- Footer Bottom -->
    <div class="footer-bottom py-3">
        <div class="container">
            <!-- Copyright -->
            <div class="copyright">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="copyright-text">
                            <p class="m-0 text-white">© 2023 Garibook.com | All Rights Reserved.</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <!-- Copyright Menu -->
                        <div class="copyright-menu text-end">
                            <div class="vistors-details text-end">
                                <img src="https://garibook.com/dashboard/new-ui/assets/image/icon/payment-method.png"
                                    alt="" width="200">
                            </div>
                        </div>
                        <!-- /Copyright Menu -->
                    </div>
                </div>
            </div>
            <!-- /Copyright -->
        </div>
    </div>
    <!-- /Footer Bottom -->
</footer>
<!-- /Footer -->


<script src="https://kit.fontawesome.com/684aa5e6c3.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
<script src="assets/js/main.js"></script>



<script>
    $(document).ready(function () {
        var start = 0;
        var limit = 6;
        var isLoading = false;

        // Initial data load
        loadData(start, limit);
        // Load More button click event
        $('#load-more-btn').on('click', function () {
            if (!isLoading) {
                isLoading = true;
                $('.ajax_load').show();
                start += limit;
                setTimeout(function () {
                    loadData(start, limit, function () {
                        isLoading = false;
                        $('.ajax_load').hide();
                    });
                }, 500);
            }
        });

        // Function to load data
        function loadData(start, limit, callback) {
            // Generate dummy data with the specified limit
            $.ajax({
                url: '/home/trips',
                method: 'GET',
                data: { skip: start, limit: limit },  // Replace 'your_token' with the actual token
                success: function (response) {
                    // Access user and trip_data from the response
                    var user = response.user;
                    var tripData = response.trip_data;

                    // Process the response data
                    console.log('User:', user);
                    console.log('Trip Data:', tripData);

                    appendDataToPage(tripData, user);
                    // Check if there is more data or if the data is empty
                    var hasMoreData = tripData.length >= limit;
                    var noDataFound = tripData.length === 0;

                    // Update the visibility of the "Load More" button
                    updateLoadMoreButtonVisibility(hasMoreData, noDataFound);


                    // Call the callback function to indicate data loading is complete
                    if (callback && typeof callback === 'function') {
                        callback();
                    }
                },
                error: function (error) {
                    console.error('Error loading data:', error);

                    // Call the callback function to indicate data loading is complete
                    if (callback && typeof callback === 'function') {
                        callback();
                    }
                }
            });
        }


        // Function to append data to the page (replace this with your actual logic)
        function appendDataToPage(data, user) {
            var container = $('.data-container');
            for (var i = 0; i < data.length; i++) {

                if (user != null) {
                    if (user.user_type == 1) {
                        if (data[i].user_id == user.id) {
                            show_trips(data[i])
                        }
                    } else {
                        show_trips(data[i])
                    }

                } else {
                    show_trips(data[i])
                }


            }

            function show_trips(data) {
                var carName = data.car_name;
                var carImage;
                // Set the image source based on car_name
                if (carName === "Sedan" || carName === "Sedan Premium") {
                    carImage = '{{ url_for("assets", path="image/cars/sedan.jpg") }}';
                } else if (carName === "Noah") {
                    carImage = '{{ url_for("assets", path="image/cars/noah.jpg") }}';
                } else if (carName === "HiAce" || carName === "Hiace") {
                    carImage = '{{ url_for("assets", path="image/cars/Hiace.png") }}';
                } else if (carName === "Tourist Bus") {
                    carImage = '{{ url_for("assets", path="image/cars/bus.jpg") }}';
                } else {
                    carImage = '{{ url_for("assets", path="image/cars/card-1.jpg") }}';
                }

                // Append the HTML with dynamic data
                container.append(`
            <div class="col-xl-4 mt-3 col-md-4 col-sm-6 col-12">
                <div class="single-card-request bg-white hover-animation-wrap">
                    <div class="scr-wrap">
                        <div class="scr-image position-relative">
                            <img src="${carImage}" alt="" class="scr-image">
                            <div class="scr-customer-image">
                                <img class="scr-c-image" src="{{ url_for('assets', path='/upload/profile/${data.customer.image}') }}" alt="">
                            </div>
                            <div class="scr-car-label">
                                <span>${carName}</span>
                            </div>
                        </div>
                        <div class="scr-text mt-4">
                            <div class="scr-header py-2">
                                <h2>${carName}</h2>
                                <div class="rating d-flex align-items-center gap-2">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star-half-stroke"></i>
                                    <i class="fa-regular fa-star"></i>
                                    <span>(5.0)</span>
                                </div>
                            </div>
                            <div class="scr-body">
                                <div class="scr-locaiton d-flex align-items-center justify-content-between mb-3">
                                    <p class="mb-0">
                                        <i class="fa-solid fa-location-dot"></i>
                                        ${data.pick_up_location}
                                    </p>
                                    <i class="fa-solid fa-car-side"></i>
                                    <p class="mb-0">
                                        <i class="fa-solid fa-location-dot"></i>
                                        ${data.location}
                                    </p>
                                </div>
                                {% if user %}
                                    {% if user.user_type == 1 %}
                                        <a href="/show/bid/${data.id}">
                                            <button type="button" class="btn-theme-primary w-100">Show Bids</button>
                                        </a>
                                    {% else %}
                                        <a href="/bid/submit/${data.id}">
                                            <button type="button" class="btn-theme-primary w-100">Bid Now</button>
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <a href="/bid/submit/${data.id}">
                                        <button type="button" class="btn-theme-primary w-100">Bid Now</button>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `);
            }
        }
        function updateLoadMoreButtonVisibility(hasMoreData, noDataFound) {
            var loadMoreButton = $('#load-more-btn');

            if (noDataFound) {
                loadMoreButton.hide();
                // Optionally show a message indicating no data found
                // $('#no-data-message').show();
            } else if (!hasMoreData) {
                loadMoreButton.hide();
            } else {
                loadMoreButton.show();
                $('#no-data-message').hide(); // Hide the no data message if it was previously shown
            }
        }



        setTimeout(function () {
            $('#ToastAlert').toast('hide');
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('error') && urlParams.get('error') === '{{error}}') {
                urlParams.delete('error');

            } else if (urlParams.has('success') && urlParams.get('success') === '{{success}}') {
                urlParams.delete('success');
            }
            var newUrl = window.location.pathname + '' + urlParams.toString();
            window.history.replaceState({}, '', newUrl);
        }, 5000);
    });
</script>
</body>

</html>


    
