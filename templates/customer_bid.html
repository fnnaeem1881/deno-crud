<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Garibook.com</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <!-- bootstrap   -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- font-family: 'Raleway', sans-serif; -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

</head>

<body>

    <header class="header-wrapper">
        <div class="container">
            <div class="col-md-12">
                <nav class="navbar">
                    <div class="container-fluid">
                        <a class="navbar-brand m-0" href="/">
                            <img src="https://garibook.com/dashboard/new-ui/assets/image/icon/logo.png" alt="Logo"
                                width="200" class="d-inline-block align-text-top">
                        </a>
                        <div class="d-flex">
                            <!-- login Modal -->
                            <div class="modal fade theme-tab-model" id="loginModal" tabindex="-1"
                                aria-labelledby="loginModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header p-0 border-0">
                                            <nav class="auth-tab-header w-100">
                                                <div class="nav nav-tabs w-100 bg-light" role="tablist">
                                                    <button class="nav-link driver active w-50 py-3"
                                                        id="nav-driverLogin-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-driverLogin" type="button" role="tab"
                                                        aria-controls="nav-home" aria-selected="true">Driver Sign
                                                        in</button>
                                                    <button class="nav-link customer w-50 py-3"
                                                        id="nav-customerLogin-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-customerLogin" type="button" role="tab"
                                                        aria-controls="nav-profile" aria-selected="false">Customer Sign
                                                        in</button>
                                                </div>
                                            </nav>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="login-form-wrapper">
                                                <div class="tab-content">
                                                    <div class="tab-pane fade show active" id="nav-driverLogin"
                                                        role="tabpanel" aria-labelledby="nav-driverLogin-tab"
                                                        tabindex="0">
                                                        <form method="POST" action="/driver-login" id="driverLoginForm">
                                                            <div class="mb-3">
                                                                <label for="usermail" class="form-label">Email
                                                                    address</label>
                                                                <input type="email" class="form-control" name="email"
                                                                    id="usermail" aria-describedby="emailHelp">
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="userPassword"
                                                                    class="form-label">Password</label>
                                                                <input type="password" class="form-control"
                                                                    name="password" id="userPassword">
                                                            </div>
                                                            <button type="submit"
                                                                class="btn-theme-primary w-100">Login</button>
                                                        </form>
                                                    </div>
                                                    <div class="tab-pane fade" id="nav-customerLogin" role="tabpanel"
                                                        aria-labelledby="nav-customerLogin-tab" tabindex="0">
                                                        <form method="post" action="/customer-login"
                                                            id="customerLoginForm">
                                                            <div class="mb-3">
                                                                <label for="usermail" class="form-label">Email
                                                                    address</label>
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" aria-describedby="emailHelp">
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="userPassword"
                                                                    class="form-label">Password</label>
                                                                <input type="password" class="form-control"
                                                                    name="password" id="userPassword">
                                                            </div>
                                                            <button type="submit"
                                                                class="btn-theme-secondary w-100">Login</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Register Modal -->
                            <div class="modal fade theme-tab-model" id="registerModal" tabindex="-1"
                                aria-labelledby="registerModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header p-0 border-0">
                                            <nav class="auth-tab-header w-100">
                                                <div class="nav nav-tabs w-100" role="tablist">
                                                    <button class="nav-link driver active w-50 py-3"
                                                        id="nav-driverResister-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-driverResister" type="button" role="tab"
                                                        aria-controls="nav-home" aria-selected="true">Driver
                                                        Register</button>
                                                    <button class="nav-link customer w-50 py-3"
                                                        id="nav-customerResister-tab" data-bs-toggle="tab"
                                                        data-bs-target="#nav-customerResister" type="button" role="tab"
                                                        aria-controls="nav-profile" aria-selected="false">Customer
                                                        Register</button>
                                                </div>
                                            </nav>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="error_div  mt-3">
                                                <!-- {% if error_customer %}
                                                <div class="alert alert-danger" role="alert">
                                                    {{ error_customer }}
                                                </div>
                                                {% elif success_customer %}
                                                <div class="alert alert-success" role="alert">
                                                    {{ success_customer }}
                                                </div>
                                                {% endif %} -->
                                            </div>
                                            <div class="register-form-wrapper">
                                                <div class="tab-content">
                                                    <div class="tab-pane fade show active" id="nav-driverResister"
                                                        role="tabpanel" aria-labelledby="nav-driverResister-tab"
                                                        tabindex="0">
                                                        <form action="/driver/register/submit" method="post"
                                                            enctype="multipart/form-data">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" name="name"
                                                                    id="name" placeholder="Driver Name ... ">
                                                                <label for="name">Name</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" placeholder="name@example.com">
                                                                <label for="name">Email Address</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="password" id="password"
                                                                    placeholder="*********">
                                                                <label for="password">Password</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="confirm_password" id="confirm_password"
                                                                    placeholder="*********">
                                                                <label for="confirm_password">Confirm Password</label>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <input type="file" class="form-control" name="image"
                                                                    id="image">
                                                            </div>
                                                            <input type="submit" class="btn btn-primary"
                                                                value="Driver Register">
                                                        </form>
                                                    </div>
                                                    <div class="tab-pane fade" id="nav-customerResister" role="tabpanel"
                                                        aria-labelledby="nav-customerResister-tab" tabindex="0">
                                                        <form action="/customer/register/submit" method="post"
                                                            enctype="multipart/form-data">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" name="name"
                                                                    id="name" placeholder="Driver Name ... ">
                                                                <label for="name">Name</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="email" class="form-control" name="email"
                                                                    id="email" placeholder="name@example.com">
                                                                <label for="name">Email Address</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="password" id="password"
                                                                    placeholder="*********">
                                                                <label for="password">Password</label>
                                                            </div>
                                                            <div class="form-floating mb-3">
                                                                <input type="password" class="form-control"
                                                                    name="confirm_password" id="confirm_password"
                                                                    placeholder="*********">
                                                                <label for="confirm_password">Confirm Password</label>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <input type="file" class="form-control" name="image"
                                                                    id="image" placeholder="name@example.com">
                                                            </div>
                                                            <input type="submit" class="btn btn-success"
                                                                value="Customer Register">
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="auth-header-wrap d-flex gap-2">
                                <button type="button" class="btn-theme-primary" data-bs-toggle="modal"
                                    data-bs-target="#loginModal">Sign In</button>
                                <button type="button" class="btn-theme-secondary" data-bs-toggle="modal"
                                    data-bs-target="#registerModal">Register</button>
                            </div>

                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    <div class="main-wrapper">
        
        <!-- Breadscrumb Section -->
		<div class="breadcrumb-bar">
			<div class="container">
				<div class="row align-items-center text-center">
		    		<div class="col-md-12 col-12">
			    	    <h2 class="breadcrumb-title">Trip Details</h2>
				    	<nav aria-label="breadcrumb" class="page-breadcrumb">
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active" aria-current="page">Details</li>
							</ol>
						</nav>							
					</div>
				</div>
			</div>
		</div>
		<!-- /Breadscrumb Section -->

        <div class="page-title-wrapper  mt-5">
            <div class="container">
                <div class="row bg-body-tertiary">
                    <div class="col-md-12">
                        <div class="trip-basic-information table-responsive">
                            <table class="table table-bordered">
                                <tbody>
                                    <tr>
                                        <td><b>Car Name: </b> {{trips.car_name}}</td>
                                        <td>
                                            <b>Booking Date: </b>
                                            <span id="formattedDate"></span>
                                        </td>
                                        <script>
                                            var date = new Date('{{trips.created_at}}');
                                            var formattedDate = date.toLocaleString();
                                            document.getElementById("formattedDate").textContent = formattedDate;
                                        </script>
                                    </tr>
                                    <tr>
                                        <td><b>Pick up location: </b> {{trips.pick_up_location}}</td>
                                        <td><b>Destination: </b> {{trips.location}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="chat-wrapper mt-3">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 mx-auto">
                        <div class="card mb-4">
                            <div class="card-header text-center">
                                <span>Trip Bid</span>
                            </div>
                            <div class="card-body chat-care">
                                <ul class="chat">

                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Customer Bin show Script Start
const socket = io(`ws://{{base_url}}:8000/`, { transports: ["websocket"] });
    socket.on("BidList{{trips.id}}", function (data) {
        console.log(data);
        var chatList = $('.chat');
        chatList.empty();
        BidGet();

    });
    BidGet();
    function displayBidInfo(bid, user) {
        var chatList = $('.chat');

        // var agentLi;
        // var imgSpan;
        // if (bid.driver_id == user.id) {
        //     agentLi = $('<li>').addClass('agent clearfix').addClass('user-' + user.id);
        //     var imgSpan = $('<span>').addClass('chat-img left clearfix mx-2');
        // } else {
        //     agentLi = $('<li>').addClass('admin clearfix').addClass('admin-' + user.id);
        //     var imgSpan = $('<span>').addClass('chat-img right clearfix mx-2');

        // }

        agentLi = $('<li>').addClass('agent clearfix').addClass('user-' + user.id);
        var imgSpan = $('<span>').addClass('chat-img left clearfix mx-2');
        imgSpan.html('<img src="../../assets/upload/profile/' + bid.driver.image + '" alt="Agent" class="img-circle" />');

        var bodyDiv = $('<div>').addClass('chat-body clearfix');

        var headerDiv = $('<div>').addClass('header clearfix');
        var strongName = $('<strong>').addClass('primary-font').text(bid.driver.name);
        var date = new Date(bid.created_at);
        var formattedDate = timeAgo(date);
        var smallTime
        if (bid.driver_id == user.id) {
            var smallTime = $('<small>').addClass('right text-muted').html('<span class="glyphicon glyphicon-time"></span>' + formattedDate);
        } else {
            var smallTime = $('<small>').addClass('left text-muted').html('<span class="glyphicon glyphicon-time"></span>' + formattedDate);
        }
        var pElement = $('<p>').text('Amount: ' + bid.amount);
        if (bid.trip.fare == null) {
            var acceptLink = $('<a>').addClass('btn btn-success').attr('href', '/bid/accept/' + bid.id).text('Accept');
            var acceptButton = $('<button>').addClass('btn btn-sm btn-success accept-btn').text('Accept');
            acceptButton.click(function (event) {
                event.preventDefault();
                window.location.href = acceptLink.attr('href');
            });
        }


        headerDiv.append(strongName);
        headerDiv.append(smallTime);

        bodyDiv.append(headerDiv);
        bodyDiv.append(pElement);

        agentLi.append(imgSpan);
        agentLi.append(bodyDiv);
        bodyDiv.append(acceptButton);

        chatList.append(agentLi);
    }
    function BidGet() {
        $.ajax({
            url: '/bid/get/{{trips.id}}',
            method: 'GET',
            success: function (data) {
                console.log(data);
                for (var i = 0; i < data.bids.length; i++) {
                    displayBidInfo(data.bids[i], data.user);
                }
            }
        });
    }
    function timeAgo(date) {
        var now = new Date();
        var diff = Math.abs(now - date);
        var minutes = Math.floor((diff / 1000) / 60);

        if (minutes < 60) {
            return minutes + ' minute' + (minutes !== 1 ? 's' : '') + ' ago';
        } else {
            var hours = Math.floor(minutes / 60);
            return hours + ' hour' + (hours !== 1 ? 's' : '') + ' ago';
        }
    }
    // Customer Bin show Script END
    </script>

    {% include 'layouts/footer.html' %}